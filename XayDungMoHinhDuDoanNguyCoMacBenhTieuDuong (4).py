{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"loqe-Q19elTg"},"outputs":[],"source":["#c√†i th∆∞ vi·ªán\n","!pip -q install gradio joblib scikit-learn google-genai"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"9XO-rDWGert5","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1770902198613,"user_tz":-420,"elapsed":25904,"user":{"displayName":"ƒê·ªì √°n Ny","userId":"06469635460222455602"}},"outputId":"c5fb5599-6da1-4672-a50d-0f6a51f3d9d9"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mHKIsCaSe81s","colab":{"base_uri":"https://localhost:8080/","height":746},"executionInfo":{"status":"ok","timestamp":1770902204014,"user_tz":-420,"elapsed":5400,"user":{"displayName":"ƒê·ªì √°n Ny","userId":"06469635460222455602"}},"outputId":"f816524c-94ba-4652-d208-9058f3588889"},"outputs":[{"output_type":"stream","name":"stdout","text":["Missing rate:\n"," Insulin                     0.486979\n","SkinThickness               0.295573\n","BloodPressure               0.045573\n","BMI                         0.014323\n","Glucose                     0.006510\n","Pregnancies                 0.000000\n","DiabetesPedigreeFunction    0.000000\n","Age                         0.000000\n","dtype: float64\n","Class balance:\n"," Outcome\n","0    0.651042\n","1    0.348958\n","Name: proportion, dtype: float64\n","\n","Chosen threshold: 0.27747758455638116\n","OOF precision: 0.5117 | OOF recall: 0.9159\n","\n","=== TEST METRICS ===\n","ROC-AUC: 0.8183\n","PR-AUC : 0.6862\n","Recall : 0.9074\n","Precision: 0.5385\n","F1: 0.6759\n","\n","Confusion matrix [[TN,FP],[FN,TP]]:\n"," [[58 42]\n"," [ 5 49]]\n","\n","Report:\n","               precision    recall  f1-score   support\n","\n","           0      0.921     0.580     0.712       100\n","           1      0.538     0.907     0.676        54\n","\n","    accuracy                          0.695       154\n","   macro avg      0.730     0.744     0.694       154\n","weighted avg      0.787     0.695     0.699       154\n","\n","\n","Saved: pima_diabetes_model.joblib\n"]},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["\n","    async function download(id, filename, size) {\n","      if (!google.colab.kernel.accessAllowed) {\n","        return;\n","      }\n","      const div = document.createElement('div');\n","      const label = document.createElement('label');\n","      label.textContent = `Downloading \"${filename}\": `;\n","      div.appendChild(label);\n","      const progress = document.createElement('progress');\n","      progress.max = size;\n","      div.appendChild(progress);\n","      document.body.appendChild(div);\n","\n","      const buffers = [];\n","      let downloaded = 0;\n","\n","      const channel = await google.colab.kernel.comms.open(id);\n","      // Send a message to notify the kernel that we're ready.\n","      channel.send({})\n","\n","      for await (const message of channel.messages) {\n","        // Send a message to notify the kernel that we're ready.\n","        channel.send({})\n","        if (message.buffers) {\n","          for (const buffer of message.buffers) {\n","            buffers.push(buffer);\n","            downloaded += buffer.byteLength;\n","            progress.value = downloaded;\n","          }\n","        }\n","      }\n","      const blob = new Blob(buffers, {type: 'application/binary'});\n","      const a = document.createElement('a');\n","      a.href = window.URL.createObjectURL(blob);\n","      a.download = filename;\n","      div.appendChild(a);\n","      a.click();\n","      div.remove();\n","    }\n","  "]},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.Javascript object>"],"application/javascript":["download(\"download_07dae33a-a1a5-4c7d-a742-16fb2219e83f\", \"pima_diabetes_model.joblib\", 2870)"]},"metadata":{}}],"source":["#Train model + ch·ªçn threshold Recall‚âà0.90 + l∆∞u joblib\n","import numpy as np\n","import pandas as pd\n","import joblib\n","\n","from sklearn.model_selection import train_test_split, StratifiedKFold, cross_val_predict\n","from sklearn.pipeline import Pipeline\n","from sklearn.impute import SimpleImputer\n","from sklearn.preprocessing import StandardScaler\n","from sklearn.linear_model import LogisticRegression\n","from sklearn.metrics import precision_recall_curve, roc_auc_score, average_precision_score\n","from sklearn.metrics import confusion_matrix, classification_report, recall_score, precision_score, f1_score\n","\n","# ===== Load data =====\n","df = pd.read_csv( \"/content/drive/MyDrive/Colab Notebooks/Dataset.csv\")\n","df.head()\n","TARGET = \"Outcome\"\n","FEATURES = [\n","    \"Pregnancies\",\"Glucose\",\"BloodPressure\",\"SkinThickness\",\n","    \"Insulin\",\"BMI\",\"DiabetesPedigreeFunction\",\"Age\"\n","]\n","ZERO_AS_MISSING = [\"Glucose\",\"BloodPressure\",\"SkinThickness\",\"Insulin\",\"BMI\"]\n","\n","X = df[FEATURES].copy()\n","y = df[TARGET].astype(int)\n","\n","# 0 gi·∫£ -> NaN\n","for col in ZERO_AS_MISSING:\n","    X[col] = X[col].replace(0, np.nan)\n","\n","print(\"Missing rate:\\n\", X.isna().mean().sort_values(ascending=False))\n","print(\"Class balance:\\n\", y.value_counts(normalize=True))\n","\n","# ===== Split =====\n","RANDOM_STATE = 42\n","X_train, X_test, y_train, y_test = train_test_split(\n","    X, y, test_size=0.2, stratify=y, random_state=RANDOM_STATE\n",")\n","\n","# ===== Pipeline =====\n","model = Pipeline(steps=[\n","    (\"imputer\", SimpleImputer(strategy=\"median\", add_indicator=True)),\n","    (\"scaler\", StandardScaler()),\n","    (\"clf\", LogisticRegression(max_iter=5000, class_weight=\"balanced\", random_state=RANDOM_STATE))\n","])\n","\n","model.fit(X_train, y_train)\n","\n","# ===== Choose threshold by OOF on TRAIN =====\n","TARGET_RECALL = 0.90\n","cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=RANDOM_STATE)\n","\n","def choose_threshold_for_recall(y_true, proba, target_recall=0.90):\n","    precision, recall, thresholds = precision_recall_curve(y_true, proba)\n","    precision_t = precision[1:]\n","    recall_t = recall[1:]\n","    thr = thresholds\n","\n","    ok = np.where(recall_t >= target_recall)[0]\n","    if len(ok) == 0:\n","        best = np.argmax(recall_t)\n","        return float(thr[best]), float(precision_t[best]), float(recall_t[best])\n","\n","    best = ok[np.argmax(precision_t[ok])]  # recall ƒë·∫°t m·ª•c ti√™u + precision cao nh·∫•t\n","    return float(thr[best]), float(precision_t[best]), float(recall_t[best])\n","\n","proba_oof = cross_val_predict(model, X_train, y_train, cv=cv, method=\"predict_proba\")[:, 1]\n","thr, p_oof, r_oof = choose_threshold_for_recall(y_train, proba_oof, TARGET_RECALL)\n","\n","print(\"\\nChosen threshold:\", thr)\n","print(\"OOF precision:\", round(p_oof, 4), \"| OOF recall:\", round(r_oof, 4))\n","\n","# ===== Evaluate on TEST =====\n","proba_test = model.predict_proba(X_test)[:, 1]\n","pred_test = (proba_test >= thr).astype(int)\n","\n","print(\"\\n=== TEST METRICS ===\")\n","print(\"ROC-AUC:\", round(roc_auc_score(y_test, proba_test), 4))\n","print(\"PR-AUC :\", round(average_precision_score(y_test, proba_test), 4))\n","print(\"Recall :\", round(recall_score(y_test, pred_test), 4))\n","print(\"Precision:\", round(precision_score(y_test, pred_test, zero_division=0), 4))\n","print(\"F1:\", round(f1_score(y_test, pred_test, zero_division=0), 4))\n","print(\"\\nConfusion matrix [[TN,FP],[FN,TP]]:\\n\", confusion_matrix(y_test, pred_test))\n","print(\"\\nReport:\\n\", classification_report(y_test, pred_test, digits=3))\n","\n","# ===== Save artifact =====\n","artifact = {\n","    \"model\": model,\n","    \"threshold\": thr,\n","    \"features\": FEATURES,\n","    \"zero_as_missing\": ZERO_AS_MISSING\n","}\n","joblib.dump(artifact, \"pima_diabetes_model.joblib\")\n","print(\"\\nSaved: pima_diabetes_model.joblib\")\n","\n","from google.colab import files\n","files.download(\"pima_diabetes_model.joblib\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"kB8CJCvziBwl"},"outputs":[],"source":["import os, getpass\n","\n","key = getpass.getpass(\"Nh·∫≠p Gemini API Key: \")\n","os.environ[\"GEMINI_API_KEY\"] = key\n","print(\"ƒê√£ set GEMINI_API_KEY\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Hy8jS6QxEHWq"},"outputs":[],"source":["url = \"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent\"\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ngpWB5oDhCYj","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1770902885456,"user_tz":-420,"elapsed":74,"user":{"displayName":"ƒê·ªì √°n Ny","userId":"06469635460222455602"}},"outputId":"198f883c-73e2-49b1-dca2-503c6424e66a"},"outputs":[{"output_type":"stream","name":"stdout","text":["'Copy of ƒêoAn.py'   Dataset.csv   ƒêoAn.py\n"]}],"source":["!ls \"/content/drive/MyDrive/Colab Notebooks\"\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"W8UU7PJ9Gyy1","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1770902885471,"user_tz":-420,"elapsed":14,"user":{"displayName":"ƒê·ªì √°n Ny","userId":"06469635460222455602"}},"outputId":"ec4822ef-2f9c-4191-f340-f792246618ad"},"outputs":[{"output_type":"stream","name":"stdout","text":["ƒê√£ set GEMINI_API_KEY\n"]}],"source":["import os\n","os.environ[\"GEMINI_API_KEY\"] = \"AIzaSyAltAuAo3g5IDnPsEvLOuCmXjb6veXQua8\"\n","print(\"ƒê√£ set GEMINI_API_KEY\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"OS3VYT2OG7Ol","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1770902885599,"user_tz":-420,"elapsed":127,"user":{"displayName":"ƒê·ªì √°n Ny","userId":"06469635460222455602"}},"outputId":"51ea9f52-e16d-42ad-c3cd-8c1f9e63362e"},"outputs":[{"output_type":"stream","name":"stdout","text":["True\n"]}],"source":["print(os.environ[\"GEMINI_API_KEY\"].startswith(\"AIza\"))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"WzlkDFOkHAcZ","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1770902885602,"user_tz":-420,"elapsed":3,"user":{"displayName":"ƒê·ªì √°n Ny","userId":"06469635460222455602"}},"outputId":"73dbaffe-4144-4b96-ac48-0bc4e4350832"},"outputs":[{"output_type":"stream","name":"stdout","text":["AIzaSy\n"]}],"source":["print(os.environ[\"GEMINI_API_KEY\"][:6])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"0T4pCX6_608T"},"outputs":[],"source":["# -*- coding: utf-8 -*-\n","import os\n","import sqlite3\n","import numpy as np\n","import pandas as pd\n","import joblib\n","import gradio as gr\n","import google.generativeai as genai\n","from datetime import datetime\n","\n","# ================= 1. C·∫§U H√åNH DATABASE =================\n","DB_NAME = \"prediction_logs.db\"\n","\n","def init_db():\n","    conn = sqlite3.connect(DB_NAME)\n","    # B·∫£ng l∆∞u th√¥ng tin c√° nh√¢n b·ªánh nh√¢n\n","    conn.execute(\"\"\"CREATE TABLE IF NOT EXISTS patients (\n","        patient_id TEXT PRIMARY KEY,\n","        full_name TEXT,\n","        gender TEXT,\n","        address TEXT,\n","        age INTEGER)\"\"\")\n","\n","    # B·∫£ng l∆∞u l·ªãch s·ª≠ c√°c l·∫ßn d·ª± ƒëo√°n\n","    conn.execute(\"\"\"CREATE TABLE IF NOT EXISTS prediction_logs (\n","        id INTEGER PRIMARY KEY AUTOINCREMENT,\n","        patient_id TEXT,\n","        pregnancies INTEGER,\n","        glucose REAL,\n","        systolic_bp REAL,\n","        diastolic_bp REAL,\n","        bmi REAL,\n","        insulin REAL,\n","        skin REAL,\n","        dpf REAL,\n","        diseases TEXT,\n","        habits TEXT,\n","        risk_percent REAL,\n","        prediction_result TEXT,\n","        timestamp DATETIME)\"\"\")\n","    conn.commit()\n","    conn.close()\n","\n","init_db()\n","\n","# ================= 2. T·∫¢I MODEL ƒê√É TRAIN =================\n","# ƒê·∫£m b·∫£o file 'pima_diabetes_model.joblib' ƒë√£ ƒë∆∞·ª£c upload l√™n c√πng th∆∞ m·ª•c\n","try:\n","    artifact = joblib.load(\"pima_diabetes_model.joblib\")\n","    model = artifact[\"model\"]\n","    features = artifact[\"features\"]\n","except Exception as e:\n","    print(f\"‚ùå L·ªói t·∫£i model: {e}. Vui l√≤ng ki·ªÉm tra file pima_diabetes_model.joblib\")\n","\n","# ================= 3. H√ÄM T∆Ø V·∫§N AI (GEMINI) =================\n","def get_ai_advice(risk, level, glucose, bmi, habits):\n","    try:\n","        api_key = \"ƒë∆∞a key √¢pi d√¥ ƒë√¢y\"\n","        if not api_key:\n","            return \"‚ö†Ô∏è Ch∆∞a c·∫•u h√¨nh API Key. Vui l√≤ng set bi·∫øn m√¥i tr∆∞·ªùng GEMINI_API_KEY.\"\n","\n","        genai.configure(api_key=api_key)\n","        # S·ª≠ d·ª•ng model flash ƒë·ªÉ t·ªëc ƒë·ªô ph·∫£n h·ªìi nhanh h∆°n\n","        gemini_model = genai.GenerativeModel('gemini-2.0-flash')\n","\n","        prompt = f\"\"\"\n","        B·∫°n l√† m·ªôt b√°c sƒ© chuy√™n gia v·ªÅ n·ªôi ti·∫øt. D·ª±a tr√™n ch·ªâ s·ªë c·ªßa b·ªánh nh√¢n:\n","        - Nguy c∆° ti·ªÉu ƒë∆∞·ªùng: {risk}% (M·ª©c ƒë·ªô: {level})\n","        - Ch·ªâ s·ªë Glucose: {glucose} mg/dL\n","        - Ch·ªâ s·ªë BMI: {bmi}\n","        - Ti·ªÅn s·ª≠/Th√≥i quen: {habits}\n","\n","        H√£y ƒë∆∞a ra l·ªùi khuy√™n ng·∫Øn g·ªçn (kho·∫£ng 100 ch·ªØ), √¢n c·∫ßn b·∫±ng ti·∫øng Vi·ªát g·ªìm:\n","        1. Ch·∫ø ƒë·ªô ƒÉn u·ªëng ph√π h·ª£p.\n","        2. Ch·∫ø ƒë·ªô v·∫≠n ƒë·ªông.\n","        3. Nh·∫Øc nh·ªü ki·ªÉm tra y t·∫ø.\n","        (L∆∞u √Ω: Ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o).\n","        \"\"\"\n","\n","        response = gemini_model.generate_content(prompt.encode(\"utf-8\").decode(\"utf-8\"))\n","        return response.text\n","    except Exception as e:\n","        return f\"‚ö†Ô∏è L·ªói k·∫øt n·ªëi AI: {str(e)}\"\n","\n","# ================= 4. LOGIC L∆ØU TR·ªÆ & D·ª∞ ƒêO√ÅN =================\n","def save_patient(pid, name, gender, address, age):\n","    if not pid or not name:\n","        return None, \"‚ùå ID v√† H·ªç t√™n kh√¥ng ƒë∆∞·ª£c tr·ªëng\"\n","\n","    conn = sqlite3.connect(DB_NAME)\n","\n","    conn.execute(\n","        \"INSERT OR REPLACE INTO patients VALUES (?, ?, ?, ?, ?)\",\n","                 (pid, name, gender, address, int(age))\n","                 )\n","    conn.commit()\n","    conn.close()\n","\n","    return {\"id\": pid, \"name\": name, \"gender\": gender, \"address\": address, \"age\": int(age)}, f\"‚úÖ ƒê√£ l∆∞u b·ªánh nh√¢n **{name}**\"\n","\n","def predict_diabetes(patient, pregnancies, glucose, systolic_bp, diastolic_bp,\n","                     bmi, insulin, skin, dpf, diseases, habits, use_ai):\n","\n","    # X·ª≠ l√Ω n·∫øu ng∆∞·ªùi d√πng ch∆∞a nh·∫•n \"L∆∞u b·ªánh nh√¢n\"\n","    if not patient:\n","        patient = {\"id\": \"TEST\", \"name\": \"B·ªánh nh√¢n Test\", \"gender\": \"N·ªØ\", \"address\": \"C√† Mau\", \"age\": 35}\n","        conn = sqlite3.connect(DB_NAME)\n","        conn.execute(\"INSERT OR IGNORE INTO patients VALUES (?, ?, ?, ?, ?)\",\n","                     (patient[\"id\"], patient[\"name\"], patient[\"gender\"], patient[\"address\"], patient[\"age\"]))\n","        conn.commit()\n","        conn.close()\n","\n","    # Chu·∫©n b·ªã d·ªØ li·ªáu cho Model (Pima Indian Dataset g·ªìm 8 ƒë·∫∑c tr∆∞ng)\n","    X = pd.DataFrame([{\n","        \"Pregnancies\": int(pregnancies),\n","        \"Glucose\": float(glucose),\n","        \"BloodPressure\": float(diastolic_bp),\n","        \"SkinThickness\": float(skin),\n","        \"Insulin\": float(insulin),\n","        \"BMI\": float(bmi),\n","        \"DiabetesPedigreeFunction\": float(dpf),\n","        \"Age\": int(patient[\"age\"])\n","    }])\n","\n","    # X·ª≠ l√Ω gi√° tr·ªã 0 th√†nh NaN nh∆∞ quy tr√¨nh training\n","    X = X.replace(0, np.nan)\n","\n","    # D·ª± ƒëo√°n x√°c su·∫•t t·ª´ Model\n","    risk_proba = model.predict_proba(X)[0][1]\n","    risk = round(float(risk_proba) * 100, 1)\n","    level = \"üü¢ Th·∫•p\" if risk < 30 else \"üü° Trung b√¨nh\" if risk < 60 else \"üî¥ Cao\"\n","\n","    # G·ªçi AI l·∫•y l·ªùi khuy√™n n·∫øu ƒë∆∞·ª£c y√™u c·∫ßu\n","    all_habits = f\"{', '.join(diseases) if diseases else 'Kh√¥ng'} | {', '.join(habits) if habits else 'Kh√¥ng'}\"\n","    ai_advice = get_ai_advice(risk, level, glucose, bmi, all_habits) if use_ai else \"üîï ƒê√£ t·∫Øt t∆∞ v·∫•n AI.\"\n","\n","    # L∆∞u l·ªãch s·ª≠ d·ª± ƒëo√°n v√†o Database\n","    conn = sqlite3.connect(DB_NAME)\n","    conn.execute(\"\"\"INSERT INTO prediction_logs VALUES\n","        (NULL, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\"\"\", (\n","        patient[\"id\"], pregnancies, glucose, systolic_bp, diastolic_bp,\n","        bmi, insulin, skin, dpf,\n","        \", \".join(diseases) if diseases else \"Kh√¥ng\",\n","        \", \".join(habits) if habits else \"Kh√¥ng\",\n","        risk, level, datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n","    ))\n","    conn.commit()\n","    conn.close()\n","\n","    return f\"\"\"\n","### üë§ K·∫øt qu·∫£ cho: **{patient['name']}** ({patient['id']})\n","üìç ƒê·ªãa ch·ªâ: {patient['address']} | Tu·ªïi: {patient['age']}\n","\n","**üî• Nguy c∆° ti·ªÉu ƒë∆∞·ªùng: {risk}%** =>  **Ph√¢n lo·∫°i: {level}**\n","\n","---\n","#### ü§ñ L·ªùi khuy√™n t·ª´ B√°c sƒ© AI (Gemini):\n","{ai_advice}\n","\n","---\n","*L∆∞u √Ω: ƒê√¢y l√† h·ªá th·ªëng h·ªó tr·ª£ quy·∫øt ƒë·ªãnh, kh√¥ng thay th·∫ø ch·∫©n ƒëo√°n c·ªßa b√°c sƒ© chuy√™n khoa.*\n","\"\"\"\n","# ================= 5. GIAO DI·ªÜN GRADIO =================\n","def load_history():\n","    conn = sqlite3.connect(DB_NAME)\n","    query = \"\"\"\n","        SELECT l.timestamp AS 'Th·ªùi gian',\n","               l.patient_id AS 'M√£ BN',\n","               COALESCE(p.full_name, 'Kh√°ch') AS 'T√™n b·ªánh nh√¢n',\n","               l.risk_percent AS 'Nguy c∆° (%)',\n","               l.prediction_result AS 'ƒê√°nh gi√°'\n","        FROM prediction_logs l\n","        LEFT JOIN patients p ON l.patient_id = p.patient_id\n","        ORDER BY l.timestamp DESC LIMIT 20\n","    \"\"\"\n","    df_history = pd.read_sql_query(query, conn)\n","    conn.close()\n","    return df_history\n","def clear_history():\n","    conn = sqlite3.connect(DB_NAME)\n","    conn.execute(\"DELETE FROM prediction_logs\")\n","    conn.commit()\n","    conn.close()\n","    return load_history()\n","with gr.Blocks(title=\"AI Diabetes - C√† Mau\") as app:\n","    gr.Markdown(\"# ü©∫ H·ªÜ TH·ªêNG D·ª∞ ƒêO√ÅN TI·ªÇU ƒê∆Ø·ªúNG AI\")\n","\n","    patient_state = gr.State()\n","#===========tab 1====================\n","    with gr.Tab(\"üë§ 1. H·ªì s∆° b·ªánh nh√¢n\"):\n","        with gr.Row():\n","            pid = gr.Textbox(label=\"üÜî M√£ ƒë·ªãnh danh (ID)\", placeholder=\"VD: BN001\")\n","            name = gr.Textbox(label=\"üë§ H·ªç v√† t√™n\", placeholder=\"Nguy·ªÖn VƒÉn A\")\n","        with gr.Row():\n","            gender = gr.Radio([\"Nam\", \"N·ªØ\", \"Kh√°c\"], label=\"Gi·ªõi t√≠nh\", value=\"N·ªØ\")\n","            age = gr.Slider(1, 120, 35, label=\"Tu·ªïi\")\n","        address = gr.Textbox(label=\"üè† ƒê·ªãa ch·ªâ\", value=\"C√† Mau\")\n","        btn_save = gr.Button(\"üíæ L∆ØU H·ªí S∆†\", variant=\"secondary\")\n","        status = gr.Markdown()\n","        btn_save.click(save_patient, [pid, name, gender, address, age], [patient_state, status])\n","#============tab 2========================\n","    with gr.Tab(\"ü©∫ 2. Kh√°m & D·ª± ƒëo√°n\"):\n","        with gr.Row():\n","            pregnancies = gr.Slider(0, 17, 1, label=\"S·ªë l·∫ßn mang thai\")\n","            glucose = gr.Slider(0, 200, 100, label=\"Ch·ªâ s·ªë ƒë∆∞·ªùng huy·∫øt (Glucose)\")\n","        with gr.Row():\n","            systolic_bp = gr.Slider(70, 200, 120, label=\"Huy·∫øt √°p t√¢m thu\")\n","            diastolic_bp = gr.Slider(40, 140, 80, label=\"Huy·∫øt √°p t√¢m tr∆∞∆°ng\")\n","        with gr.Row():\n","            bmi = gr.Slider(10, 60, 25, label=\"Ch·ªâ s·ªë kh·ªëi c∆° th·ªÉ (BMI)\")\n","            insulin = gr.Slider(0, 900, 0, label=\"Ch·ªâ s·ªë Insulin\")\n","        with gr.Row():\n","            skin = gr.Slider(0, 99, 20, label=\"ƒê·ªô d√†y n·∫øp g·∫•p da\")\n","            dpf = gr.Slider(0.0, 2.5, 0.3, step=0.01, label=\"Ch·ªâ s·ªë di truy·ªÅn (DPF)\")\n","\n","        diseases = gr.CheckboxGroup([\"TƒÉng huy·∫øt √°p\", \"Tim m·∫°ch\", \"B√©o ph√¨\"], label=\"B·ªánh l√Ω n·ªÅn\")\n","        habits = gr.CheckboxGroup([\"√çt v·∫≠n ƒë·ªông\", \"H√∫t thu·ªëc\", \"ƒÇn nhi·ªÅu ƒë·ªì ng·ªçt\"], label=\"Th√≥i quen sinh ho·∫°t\")\n","        use_ai = gr.Checkbox(True, label=\"ü§ñ K√≠ch ho·∫°t Tr·ª£ l√Ω ·∫£o Gemini t∆∞ v·∫•n\")\n","\n","        btn_predict = gr.Button(\"üìä PH√ÇN T√çCH CH·ªà S·ªê\", variant=\"primary\")\n","        result = gr.Markdown()\n","\n","        btn_predict.click(\n","            predict_diabetes,\n","            inputs=[patient_state, pregnancies, glucose, systolic_bp, diastolic_bp,\n","                    bmi, insulin, skin, dpf, diseases, habits, use_ai],\n","            outputs=result\n","        )\n","    # ================= TAB 3 =================\n","    with gr.Tab(\"üìú 3. Nh·∫≠t k√Ω h·ªá th·ªëng\"):\n","\n","        with gr.Row():\n","            btn_refresh = gr.Button(\"üîÑ C·∫¨P NH·∫¨T L·ªäCH S·ª¨\")\n","            btn_clear = gr.Button(\"üóë XO√Å TO√ÄN B·ªò L·ªäCH S·ª¨\", variant=\"stop\")\n","\n","        history_table = gr.Dataframe(value=load_history())\n","\n","        btn_refresh.click(\n","            fn=load_history,\n","            outputs=history_table\n","        )\n","\n","        btn_clear.click(\n","            fn=clear_history,\n","            outputs=history_table\n","        )\n","# Launch app\n","app.launch(share=True, debug=True)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gnkJw-v8Ta4s"},"outputs":[],"source":["import sqlite3\n","\n","conn = sqlite3.connect(\"prediction_logs.db\")\n","cur = conn.cursor()\n","\n","cur.execute(\"DROP TABLE IF EXISTS patient\")\n","\n","conn.commit()\n","conn.close()\n","\n","print(\"‚úÖ ƒê√£ xo√° b·∫£ng patient\")"]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}
